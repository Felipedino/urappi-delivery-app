<!-- Este html corresponde a cada cuadro con información de la notificación correspondiente -->
{% load static %}
<!-- Mensaje según el tipo -->
<div class="w-full max-w-lg rounded-lg bg-white shadow-md relative">
    <form method="post" action="{% url 'delete_notification' notification.id %}">
        {% csrf_token %}
        <input type="hidden" name="notification_id" value="{{ notification.id }}">
        <button type="submit" class="absolute top-1 right-1 p-1 rounded-full hover:bg-gray-100 transition-colors" id="delete-notif-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 hover:text-red-500" 
                viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" 
                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" 
                    clip-rule="evenodd"/>
            </svg>
        </button>
    </form>
    
    <div class="textarea-md p-6">
        {% if notification.type == "entregado" %}
            <h3 class="text-xl font-bold">¡Tu pedido ha sido entregado!</h3>
        {% elif notification.type == "cancelado" %}
            <h3 class="text-xl font-bold">Tu pedido ha sido cancelado :c</h3>
        {% elif notification.type == "aceptado" %}
            <h3 class="text-xl font-bold">¡Tu pedido está en camino!</h3>
        {% endif %}
        <p> {{notification.message}} </p>

        {% if notification.type == "entregado" and notification.order.rated == False %}
            {% if notification.order.deliverer %}
            <form method="post" action="{% url 'rate_deliverer' notification.order.deliverer.id %}">
                {% csrf_token %}
                <input type="hidden" name="order_id" value="{{ notification.order.id }}">
                    
                <div class="rating-stars">
                    <span>Califica esta entrega: </span>
                    {% for i in "12345" %}
                        <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" {% if forloop.first %}checked{% endif %}>
                        <label for="star{{ i }}">★</label>
                    {% endfor %}
                </div>
                <button type="submit" class="btn btn-primary"> Enviar calificación </button>
            </form>
            {% endif %}
        {% endif %}
    </div>

</div>

<script>
    function deleteNotifRequest() {
        fetch("{% url 'delete_notification' notification.id %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(res => {
            if (!res.ok) throw new Error('Failed');
            window.location.reload();
        })
        .catch(err => console.error(err));
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>